<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">


	<select id="board_list_page" parameterType="Map" resultType="vo.BoardVo">
		SELECT v.*
		FROM (
		    SELECT
		        p.*, 
		        RANK() OVER (ORDER BY b_idx DESC) AS no
		    FROM (
		        SELECT * FROM board
		    ) p
		) v
		WHERE no BETWEEN #{start} AND #{end}
	</select>
	
<!--  ************************** BOARD_ROW_TOTAL  ***************************** -->
	<select id="board_row_total" resultType="int">
		select nvl(count(*),0) from board
	</select>
<!--  ************************** BOARD_ROW_TOTAL  ***************************** -->

	
<!-- ************************** BOARD_LIST_ALL  ***************************** -->
	<resultMap type="vo.BoardVo"  id="BoardMap">
	    <result property="b_idx"  column="b_idx"/>
	    <collection property="image_list"
	                    column="b_idx"
	                    select="board_image_list"
	                    />
	</resultMap>
	
	
	<select id="board_image_list"  resultType="vo.BoardImagesVo">
	     select * from board_images where b_idx=#{ b_idx } 
	</select>
	
	
	<select id="board_list_all" resultMap="BoardMap">
		select
			rank() over(order by b_idx desc) as no, b.*
			from 
			(select * from board ) b
	</select>
<!-- ************************** BOARD_LIST_ALL  ***************************** -->
	

<!-- ************************** BOARD_LIST_B_CATE  ***************************** -->
	<resultMap type="vo.BoardVo"  id="BoardMap3">
	    <result property="b_idx"  column="b_idx"/>
	    <collection property="image_list"
	                    column="b_idx"
	                    select="board_image_list"
	                    />
	</resultMap>
	
	
	<select id="board_image_list3"  resultType="vo.BoardImagesVo">
	     select * from board_images where b_idx=#{ b_idx } 
	</select>
	
	
	<select id="board_list" parameterType="String" resultMap="BoardMap3">
		select
			rank() over(order by b_idx desc) as no, b.*
			from 
			(select * from board where b_cate = #{b_cate} ) b
	</select>
<!-- ************************** BOARD_LIST_B_CATE  ***************************** -->




	
<!-- ************************** BOARD_INSERT ************************** -->
 	<insert id="board_insert" parameterType="vo.BoardVo" >
 			insert into board values(seq_board_b_idx.nextVal,
 											#{m_idx},
 											#{b_cate},
 											#{b_title},
 											#{b_content},
 											sysdate,
 											sysdate,
 											sysdate,
 											#{m_name}
 											)
	</insert> 
<!-- ************************** BOARD_INSERT ************************** -->



<!-- ************************** GET_B_IDX ************************** -->	
<select id="board_get_b_idx"  resultType="int">
  		select seq_board_b_idx.currVal from dual
</select>
<!-- ************************** GET_B_IDX ************************** -->	


<!-- ************************** INSERT_BOARD_IMAGES ************************** -->	
 	<insert id="board_insert_images" parameterType="vo.BoardImagesVo">
 			insert into board_images (img_idx, b_idx, b_filename)
 			 values(seq_board_images_img_idx.nextVal,
 											#{b_idx},
 											#{b_filename}
 											)
	</insert> 
<!-- ************************** INSERT_BOARD_IMAGES ************************** -->	




<!-- ************************** BOARD_VIEW  ***************************** -->

	<resultMap type="vo.BoardVo"  id="BoardMap2">
	    <result property="b_idx"  column="b_idx"/>
	    <collection property="image_list"
	                    column="b_idx"
	                    select="board_image_list2"
	                    />
	</resultMap>
	
	
	<select id="board_image_list2"  resultType="vo.BoardImagesVo">
	     select * from board_images where b_idx=#{ b_idx } 
	</select>
	
	
	<select id="board_list_one" parameterType="int" resultMap="BoardMap2">
	      select * from board where b_idx = #{b_idx}
	</select>

<!-- ************************** BOARD_VIEW  ***************************** -->



<!-- ************************** BOARD_UPDATE  ***************************** -->
	<update id="board_update" parameterType="vo.BoardVo">
		update board set b_title = #{b_title},
						 b_content = #{b_content},
						 b_udate = sysdate
						 where b_idx = #{b_idx}
	</update>
<!-- ************************** BOARD_UPDATE  ***************************** -->



<!-- ************************** BOARD_DELETE  ***************************** -->
	<delete id="board_delete" parameterType="int">
		delete from board where b_idx = #{b_idx}
	</delete>



<!-- ************************** BOARD_DELETE  ***************************** -->


</mapper>












